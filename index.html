<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Pump.Fun New Tokens Explorer</title>
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0f0f13;
  color: #fff;
  padding: 12px;
}
h1 {
  text-align: center;
  margin-bottom: 16px;
  color: #55ff99;
}
.controls {
  display:flex;
  justify-content:center;
  gap:12px;
  margin-bottom:12px;
}
.select-sort {
  background:#1b1b1f;
  color:#fff;
  border:1px solid rgba(255,255,255,0.03);
  border-radius:6px;
  padding:6px 10px;
}
.token-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill,minmax(320px,1fr));
  gap: 12px;
}
.card {
  background: #1b1b1f;
  border-radius: 12px;
  padding: 12px;
  border: 1px solid rgba(255,255,255,0.03);
  transition: transform 0.15s;
}
.card:hover { transform: translateY(-4px); box-shadow:0 10px 30px rgba(0,0,0,0.5);}
.token-header {
  display:flex; align-items:center; gap:10px; margin-bottom:8px;
}
.logo { width:48px; height:48px; border-radius:10px; object-fit:cover; background:#07070a;}
.title { font-weight:700; font-size:1.1em;}
.small { font-size:12px; color:#aaa;}
.copy-btn {cursor:pointer; color:#55ff99; margin-left:6px;}
.metric {margin-top:6px;}
</style>
</head>
<body>

<h1>Pump.Fun New Tokens</h1>
<div class="controls">
  <label>Sort by:
    <select id="sortSelect" class="select-sort">
      <option value="created">Newest</option>
      <option value="marketCap">Market Cap</option>
      <option value="holders">Holders</option>
    </select>
  </label>
</div>

<div id="tokenGrid" class="token-grid">
  <p>Loading tokens...</p>
</div>

<script>
const API_KEY = 'e6d255f4-d3ce-457f-b149-883b2f3e93e2';
const tokenGrid = document.getElementById('tokenGrid');
const sortSelect = document.getElementById('sortSelect');
let solPrice = 30; 
let allTokens = [];

async function fetchSolPrice(){
  try{
    const r = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=solana&vs_currencies=usd');
    const j = await r.json();
    solPrice = j?.solana?.usd || solPrice;
  }catch(e){ console.warn('Failed fetching SOL price', e);}
}

function fmtUSD(value){ return '$'+Number(value||0).toLocaleString(undefined,{maximumFractionDigits:4}); }
function fmtSOL(value){ return ((value||0)/solPrice).toFixed(4)+' SOL'; }

async function fetchTokens(){
  await fetchSolPrice();
  try{
    const r = await fetch('https://data.solanatracker.io/search?market=pumpfun&limit=50', {
      headers: { 'x-api-key': API_KEY }
    });
    const j = await r.json();
    const tokens = j.data || [];
    const now = Date.now();
    allTokens = tokens.filter(t => t.createdAt && (now - t.createdAt)<3600000); // new tokens <1h
    sortAndRender();
  }catch(e){
    console.error('fetchTokens error', e);
    tokenGrid.innerHTML = `<p class="small">Error fetching tokens: ${e.message||e}</p>`;
  }
}

function sortAndRender(){
  const sortBy = sortSelect.value;
  let sorted = [...allTokens];
  if(sortBy==='marketCap'){
    sorted.sort((a,b)=>(b.marketCapUsd||0)-(a.marketCapUsd||0));
  }else if(sortBy==='created'){
    sorted.sort((a,b)=>(b.createdAt||0)-(a.createdAt||0));
  }else if(sortBy==='holders'){
    sorted.sort((a,b)=>(b.holders||0)-(a.holders||0));
  }
  renderTokens(sorted);
}

function renderTokens(tokens){
  tokenGrid.innerHTML = '';
  if(!tokens.length){
    tokenGrid.innerHTML = `<p class="small">No new tokens found in the last hour.</p>`;
    return;
  }
  tokens.forEach(t=>{
    const card = document.createElement('div'); card.className='card';
    const mintShort = (t.mint||'').slice(0,6)+'...'+(t.mint||'').slice(-6);
    card.innerHTML=`
      <div class="token-header">
        <img class="logo" src="${t.image||''}" alt="${t.symbol||''}"/>
        <div>
          <div class="title">${t.name || 'N/A'} (${t.symbol || 'N/A'})</div>
          <div class="small">Contract: <a href="https://solscan.io/token/${t.mint}" target="_blank">${mintShort}</a>
            <span class="copy-btn" data-mint="${t.mint}">ðŸ“‹</span>
          </div>
        </div>
      </div>
      <div class="metric">Market Cap: ${fmtUSD(t.marketCapUsd)}</div>
      <div class="metric">Price: ${fmtUSD(t.priceUsd)} / ${fmtSOL(t.priceUsd)}</div>
      <div class="metric small">Holders: ${t.holders||0}</div>
    `;
    tokenGrid.appendChild(card);
  });

  document.querySelectorAll('.copy-btn').forEach(btn=>{
    btn.onclick = ()=>{
      const m = btn.getAttribute('data-mint');
      if(navigator.clipboard) navigator.clipboard.writeText(m);
      btn.textContent='âœ…';
      setTimeout(()=>btn.textContent='ðŸ“‹',1000);
    };
  });
}

sortSelect.onchange = sortAndRender;

fetchTokens();
setInterval(fetchTokens, 5000);
</script>

</body>
</html>
