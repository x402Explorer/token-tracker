<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Degen Radar Pro</title>
<style>
  body { background:#121212; color:#fff; font-family:Arial,sans-serif; margin:0; padding:1rem; }
  h1 { text-align:center; color:#55ff99; margin-bottom:10px; }
  .controls, .filters { text-align:center; margin-bottom:15px; }
  button { margin:0 5px; padding:6px 12px; border:none; border-radius:5px; cursor:pointer; background:#333; color:#fff; font-weight:bold; }
  button:hover { background:#55ff99; color:#000; }
  input, select { margin:0 5px; }
  .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap:12px; }
  .card { background:#1e1e1e; border-radius:10px; padding:10px; box-shadow:0 4px 12px rgba(0,0,0,0.5); transition:transform 0.2s; }
  .card:hover { transform:translateY(-5px); box-shadow:0 8px 20px rgba(0,0,0,0.7); }
  .token-logo { width:40px; height:40px; border-radius:50%; vertical-align:middle; margin-right:8px; }
  .token-header { display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; }
  .badge { display:inline-block; padding:2px 6px; border-radius:4px; font-size:0.7em; margin-left:5px; }
  .green { background:#1b2a1b; }
  .yellow { background:#3a3a1a; }
  .red { background:#3a1a1a; }
  .new-badge { background:#ff55aa; color:#fff; font-weight:bold; }
  .trend-badge { background:#ffaa00; color:#000; font-weight:bold; }
  .metric { font-size:0.85em; margin:3px 0; }
  a { color:#55ff99; text-decoration:none; }
  a:hover { text-decoration:underline; }
  .copy-btn { cursor:pointer; font-size:0.8em; margin-left:6px; color:#55ff99; }
</style>
</head>
<body>

<h1>Degen Radar Pro</h1>

<div class="controls">
  <button onclick="sortBy('hot')">Sort by Hot</button>
  <button onclick="sortBy('volume')">Sort by Volume</button>
  <button onclick="sortBy('risk')">Sort by Risk</button>
  <button onclick="toggleCurrency()">Toggle SOL / $</button>
</div>

<div class="filters">
  Hot > <input type="number" id="filterHot" value="0" step="10">
  Liquidity > <input type="number" id="filterLiquidity" value="0" step="100">
  Dev % < <input type="number" id="filterDev" value="100" step="1">
  Age < <input type="number" id="filterAge" value="24" step="1">h
  Token Age:
  <select id="filterAgeGroup">
    <option value="all">All</option>
    <option value="new">New (â‰¤1h)</option>
    <option value="old">Old (>1h)</option>
  </select>
  <button onclick="applyFilters()">Apply Filters</button>
</div>

<div class="grid" id="tokenGrid">
  Loading tokens...
</div>

<script>
const trackerApiKey = 'e6d255f4-d3ce-457f-b149-883b2f3e93e2';
let allTokens = [];
let currentSort = 'hot';
let showInUSD = true;
let solPrice = 30;

async function fetchSOLPrice() {
  try {
    const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=solana&vs_currencies=usd');
    const data = await res.json();
    solPrice = data.solana.usd;
  } catch(e) { console.error('SOL price fetch error', e); }
}

async function fetchTokens() {
  await fetchSOLPrice();
  try {
    const res = await fetch('https://data.solanatracker.io/search?name=a&symbol=a', {
      headers: { 'x-api-key': trackerApiKey }
    });
    const json = await res.json();
    allTokens = json.data || [];
    applyFilters();
  } catch(e) {
    console.error(e);
    document.getElementById('tokenGrid').innerHTML = 'Error fetching tokens';
  }
}

function computeMetrics(token) {
  const now = Date.now();
  const ageHours = token.createdAt ? (now - token.createdAt) / 3600000 : 1;
  const priceChange = token.priceChange1h || 0;
  const priceFactor = 1 + (priceChange / 100);
  const hot = ((token.volume || 0) * priceFactor) / ageHours;

  let riskScore = 0;
  if ((token.dev || 0) > 20 || (token.liquidityUsd || 0) < 100) riskScore = 2;
  else if ((token.dev || 0) > 10 || (token.liquidityUsd || 0) < 500) riskScore = 1;

  return { hot, riskScore, ageHours };
}

function formatValue(value) {
  if (showInUSD) return '$' + (value || 0).toFixed(2);
  return ((value || 0) / solPrice).toFixed(4) + ' SOL';
}

function getLifecycleBadge(token) {
  if (token.launchpad && token.launchpad.curvePercentage < 100)
    return '<span class="badge new-badge">NEW CREATION</span>';
  if (token.launchpad && token.launchpad.curvePercentage === 100 && !token.migrated)
    return '<span class="badge yellow">TO MIGRATE</span>';
  if (token.migrated)
    return '<span class="badge green">MIGRATED</span>';
  return '';
}

function sortBy(type) {
  currentSort = type;
  applyFilters();
}

function toggleCurrency() {
  showInUSD = !showInUSD;
  applyFilters();
}

function applyFilters() {
  const minHot = parseFloat(document.getElementById('filterHot').value);
  const minLiquidity = parseFloat(document.getElementById('filterLiquidity').value);
  const maxDev = parseFloat(document.getElementById('filterDev').value);
  const maxAge = parseFloat(document.getElementById('filterAge').value);
  const ageGroup = document.getElementById('filterAgeGroup').value;

  const now = Date.now();

  const filtered = allTokens.filter(t => {
    const { hot, ageHours } = computeMetrics(t);
    const passHot = hot > minHot;
    const passLiq = (t.liquidityUsd || 0) > minLiquidity;
    const passDev = (t.dev || 0) < maxDev;
    const passAge = ageHours < maxAge;
    const passGroup = (ageGroup === 'all') ||
      (ageGroup === 'new' && ageHours <= 1) ||
      (ageGroup === 'old' && ageHours > 1);
    return passHot && passLiq && passDev && passAge && passGroup;
  });

  allTokens = filtered.sort((a, b) => {
    const ma = computeMetrics(a);
    const mb = computeMetrics(b);
    if (currentSort === 'hot') return mb.hot - ma.hot;
    if (currentSort === 'volume') return (b.volume || 0) - (a.volume || 0);
    if (currentSort === 'risk') return ma.riskScore - mb.riskScore;
    return 0;
  });

  updateGrid();
}

function updateGrid() {
  const grid = document.getElementById('tokenGrid');
  grid.innerHTML = '';

  if (allTokens.length === 0) {
    grid.innerHTML = 'No tokens found';
    return;
  }

  allTokens.slice(0, 50).forEach(t => {
    const { hot, riskScore, ageHours } = computeMetrics(t);
    const riskClass = riskScore === 0 ? 'green' : riskScore === 1 ? 'yellow' : 'red';
    const isTrending = (t.volume_5m || 0) > (t.volume_15m || 0) * 1.2;

    const card = document.createElement('div');
    card.className = 'card ' + riskClass;
    card.innerHTML = `
      <div class="token-header">
        <div>
          <img class="token-logo" src="${t.image || ''}" alt="${t.symbol}">
          <strong>${t.name || 'N/A'} (${t.symbol || 'N/A'})</strong>
          ${getLifecycleBadge(t)}
          ${isTrending ? '<span class="badge trend-badge">TREND</span>' : ''}
        </div>
        <span class="badge ${riskClass}">
          ${riskClass === 'green' ? 'Safe' : riskClass === 'yellow' ? 'Caution' : 'Risk'}
        </span>
      </div>
      <div class="metric">Hot: ${hot.toFixed(2)}</div>
      <div class="metric">Volume: ${formatValue(t.volume)}</div>
      <div class="metric">Market Cap: ${formatValue(t.marketCapUsd)}</div>
      <div class="metric">Liquidity: ${formatValue(t.liquidityUsd)}</div>
      <div class="metric">Dev: ${(t.dev || 0).toFixed(2)}%</div>
      <div class="metric">Age: ${ageHours.toFixed(2)}h</div>
      <div class="metric">Contract: 
        <a href="https://solscan.io/token/${t.mint}" target="_blank">${t.mint.slice(0,6)}...${t.mint.slice(-6)}</a>
        <span class="copy-btn" onclick="navigator.clipboard.writeText('${t.mint}')">ðŸ“‹</span>
      </div>
    `;
    grid.appendChild(card);
  });
}

fetchTokens();
setInterval(fetchTokens, 30000);
</script>

</body>
</html>
