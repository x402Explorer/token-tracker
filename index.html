<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Pump.Fun Token Radar</title>
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0f0f13;
  color: #fff;
  padding: 12px;
}
h1 {
  text-align: center;
  margin-bottom: 16px;
  color: #55ff99;
}
.controls {
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:12px;
  margin-bottom:12px;
}
select {
  background:#1b1b1f;
  color:#fff;
  border:1px solid rgba(255,255,255,0.05);
  border-radius:6px;
  padding:6px 10px;
}
.token-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill,minmax(320px,1fr));
  gap: 12px;
}
.card {
  background: #1b1b1f;
  border-radius: 12px;
  padding: 12px;
  border: 1px solid rgba(255,255,255,0.05);
  transition: transform 0.15s;
}
.card:hover {
  transform: translateY(-4px);
  box-shadow:0 10px 30px rgba(0,0,0,0.4);
}
.token-header {
  display:flex; align-items:center; gap:10px; margin-bottom:8px;
}
.logo {
  width:48px; height:48px; border-radius:10px; object-fit:cover; background:#07070a;
}
.title { font-weight:700; font-size:1.05em;}
.small { font-size:12px; color:#aaa;}
.copy-btn {cursor:pointer; color:#55ff99; margin-left:6px;}
.metric {margin-top:6px;}
.social-links {margin-top:6px;}
.social-links a {margin-right:8px;color:#55ff99;text-decoration:none;}
</style>
</head>
<body>

<h1>Pump.Fun Token Radar</h1>

<div class="controls">
  <label>Sort by:
    <select id="sortSelect">
      <option value="created">Newest</option>
      <option value="marketCap">Market Cap</option>
      <option value="holders">Holders</option>
      <option value="liquidity">Liquidity</option>
    </select>
  </label>
  <label>Age filter:
    <select id="timeFilter">
      <option value="3600000">Last 1h</option>
      <option value="14400000">Last 4h</option>
      <option value="28800000">Last 8h</option>
      <option value="43200000">Last 12h</option>
      <option value="86400000">Last 24h</option>
      <option value="604800000">Last 1w</option>
      <option value="2592000000">Last 1mo</option>
      <option value="0">All</option>
    </select>
  </label>
</div>

<div id="tokenGrid" class="token-grid">
  <p>Loading tokens...</p>
</div>

<script>
const API_KEY = 'e6d255f4-d3ce-457f-b149-883b2f3e93e2';
const tokenGrid = document.getElementById('tokenGrid');
const sortSelect = document.getElementById('sortSelect');
const timeFilter = document.getElementById('timeFilter');
let allTokens = [];

function formatAge(ms){
  let sec = Math.floor(ms/1000);
  const h = Math.floor(sec/3600); sec%=3600;
  const m = Math.floor(sec/60); sec%=60;
  return `${h}h ${m}m ${sec}s`;
}

// === Fetch up to 10k tokens with pagination ===
async function fetchAllTokens(limit = 10000){
  let all = [];
  let cursor = null;
  const perPage = 100;
  const maxPages = Math.ceil(limit / perPage);

  for(let i=0;i<maxPages;i++){
    let url = `https://data.solanatracker.io/markets?market=pumpfun&limit=${perPage}`;
    if(cursor) url += `&cursor=${encodeURIComponent(cursor)}`;
    const res = await fetch(url, { headers: {'x-api-key': API_KEY} });
    if(!res.ok){ console.warn("Fetch failed",res.status); break; }
    const j = await res.json();
    const data = j.data || [];
    all.push(...data);
    cursor = j.nextCursor;
    if(!cursor) break;
    await new Promise(r=>setTimeout(r,150)); // respect API
  }
  return all;
}

function filterAndRender(){
  const maxAge = parseInt(timeFilter.value);
  const now = Date.now();
  let tokens = [...allTokens];
  if(maxAge>0){
    tokens = tokens.filter(t=>t.createdAt && now - t.createdAt <= maxAge);
  }

  const sortBy = sortSelect.value;
  if(sortBy==='marketCap') tokens.sort((a,b)=>(b.marketCapUsd||0)-(a.marketCapUsd||0));
  else if(sortBy==='holders') tokens.sort((a,b)=>(b.holders||0)-(a.holders||0));
  else if(sortBy==='liquidity') tokens.sort((a,b)=>(b.liquidityUsd||0)-(a.liquidityUsd||0));
  else tokens.sort((a,b)=>(b.createdAt||0)-(a.createdAt||0));

  renderTokens(tokens);
}

function renderTokens(tokens){
  tokenGrid.innerHTML = '';
  if(!tokens.length){
    tokenGrid.innerHTML = `<p class="small">No tokens match this filter.</p>`;
    return;
  }
  const now = Date.now();
  tokens.forEach(t=>{
    const card = document.createElement('div'); card.className='card';
    const mint = t.mint || '';
    const mintShort = mint ? mint.slice(0,6)+'...'+mint.slice(-6) : 'N/A';
    const age = t.createdAt ? formatAge(now - t.createdAt) : 'â€”';
    let socials = '';
    if(t.socials){
      for(const [k,v] of Object.entries(t.socials)){
        socials += `<a href="${v}" target="_blank">${k}</a>`;
      }
    }
    card.innerHTML = `
      <div class="token-header">
        <img class="logo" src="${t.image||''}" alt="${t.symbol||''}">
        <div>
          <div class="title">${t.name||'N/A'} (${t.symbol||'N/A'})</div>
          <div class="small">CA: <a href="https://solscan.io/token/${mint}" target="_blank">${mintShort}</a>
            <span class="copy-btn" data-mint="${mint}">ðŸ“‹</span>
          </div>
        </div>
      </div>
      <div class="metric">Market Cap: $${(t.marketCapUsd||0).toLocaleString()}</div>
      <div class="metric">Liquidity: $${(t.liquidityUsd||0).toLocaleString()}</div>
      <div class="metric small">Holders: ${t.holders||0}</div>
      <div class="metric small">Age: ${age}</div>
      <div class="metric small"><a href="https://dexscreener.com/solana/${mint}" target="_blank" style="color:#55ff99;">View Chart â†—</a></div>
      ${socials ? `<div class="social-links">${socials}</div>` : ''}
    `;
    tokenGrid.appendChild(card);
  });

  document.querySelectorAll('.copy-btn').forEach(btn=>{
    btn.onclick = ()=>{
      const m = btn.getAttribute('data-mint');
      if(navigator.clipboard) navigator.clipboard.writeText(m);
      btn.textContent='âœ…';
      setTimeout(()=>btn.textContent='ðŸ“‹',1000);
    };
  });
}

async function init(){
  tokenGrid.innerHTML = '<p>Loading 10,000 tokens...</p>';
  allTokens = await fetchAllTokens(10000);
  filterAndRender();
}

sortSelect.onchange = filterAndRender;
timeFilter.onchange = filterAndRender;

init();
setInterval(init, 300000); // refresh every 5min
</script>

</body>
</html>
